Only in after/: bears.json
Only in after/pinot-core: classpath.info
diff -r -x '*.log' -x '*.config' -x '*git*' -x '*.md' -x '*.xml' before/pinot-core/src/main/java/com/linkedin/pinot/core/data/manager/realtime/LLRealtimeSegmentDataManager.java after/pinot-core/src/main/java/com/linkedin/pinot/core/data/manager/realtime/LLRealtimeSegmentDataManager.java
142c142,146
<       FileUtils.deleteQuietly(new File(_segmentFile));
---
>       // If segment build fails with an exception then we will not be able to create a segment file and
>       // the file name will be null.
>       if (_segmentFile != null) {
>         FileUtils.deleteQuietly(new File(_segmentFile));
>       }
diff -r -x '*.log' -x '*.config' -x '*git*' -x '*.md' -x '*.xml' before/pinot-core/src/test/java/com/linkedin/pinot/core/data/manager/realtime/LLRealtimeSegmentDataManagerTest.java after/pinot-core/src/test/java/com/linkedin/pinot/core/data/manager/realtime/LLRealtimeSegmentDataManagerTest.java
254a255,273
>   @Test
>   public void testSegmentBuildException() throws Exception {
>     FakeLLRealtimeSegmentDataManager segmentDataManager = createFakeSegmentManager();
>     LLRealtimeSegmentDataManager.PartitionConsumer consumer = segmentDataManager.createPartitionConsumer();
>     final long endOffset = _startOffset + 500;
>     // We should consume initially...
>     segmentDataManager._consumeOffsets.add(endOffset);
>     final SegmentCompletionProtocol.Response commitResponse = new SegmentCompletionProtocol.Response(
>         new SegmentCompletionProtocol.Response.Params().withOffset(endOffset).withStatus(
>             SegmentCompletionProtocol.ControllerResponseStatus.COMMIT));
>     segmentDataManager._responses.add(commitResponse);
>     segmentDataManager._failSegmentBuild = true;
> 
>     consumer.run();
>     Assert.assertTrue(segmentDataManager._buildSegmentCalled);
>     Assert.assertEquals(segmentDataManager._state.get(segmentDataManager), LLRealtimeSegmentDataManager.State.ERROR);
>   }
> 
> 
629a649
>     public boolean _failSegmentBuild = false;
762a783,785
>       if (_failSegmentBuild) {
>         return null;
>       }
