diff -r -x '*.config' -x '*git*' -x '*.md' -x '*.xml' d4j_buggy/Compress43/src/main/java/org/apache/commons/compress/archivers/zip/ZipArchiveOutputStream.java d4j_patched/Compress43/src/main/java/org/apache/commons/compress/archivers/zip/ZipArchiveOutputStream.java
1034c1034
<         metaData.put(ze, new EntryMetaData(localHeaderStart, usesDataDescriptor(ze.getMethod())));
---
>         metaData.put(ze, new EntryMetaData(localHeaderStart, usesDataDescriptor(ze.getMethod(), phased)));
1075c1075
<         final boolean dataDescriptor = usesDataDescriptor(zipMethod);
---
>         final boolean dataDescriptor = usesDataDescriptor(zipMethod, phased);
1171c1171
<         if (ze.getMethod() != DEFLATED || channel != null) {
---
>         if (!usesDataDescriptor(ze.getMethod(), false)) {
1492,1493c1492,1493
<     private boolean usesDataDescriptor(final int zipMethod) {
<         return zipMethod == DEFLATED && channel == null;
---
>     private boolean usesDataDescriptor(final int zipMethod, boolean phased) {
>         return !phased && zipMethod == DEFLATED && channel == null;
